<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register as Leader - WizDesk</title>
    <style>
        /* Your existing CSS is perfect and doesn't need changes. */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .container { max-width: 500px; width: 100%; }
        header { text-align: center; color: white; margin-bottom: 30px; }
        header h1 { font-size: 3rem; margin-bottom: 10px; font-weight: 700; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        header p { font-size: 1.2rem; opacity: 0.9; }
        .form-card { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
        .form-card h2 { text-align: center; margin-bottom: 30px; color: #333; font-size: 1.8rem; font-weight: 600; }
        .form-group { margin-bottom: 20px; position: relative; }
        input { width: 100%; padding: 15px 20px; border: 2px solid #e1e5e9; border-radius: 10px; font-size: 16px; transition: all 0.3s ease; background: #f8f9fa; }
        input:focus { outline: none; border-color: #667eea; background: white; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        input.error { border-color: #dc3545; }
        input.success { border-color: #28a745; }
        .password-match { display: none; font-size: 14px; margin-top: 5px; padding: 5px 10px; border-radius: 5px; }
        .password-match.error { display: block; color: #dc3545; background: #f8d7da; }
        .password-match.success { display: block; color: #155724; background: #d4edda; }
        .password-strength { margin-top: 5px; font-size: 14px; padding: 5px 10px; border-radius: 5px; display: none; }
        .password-strength.weak { display: block; color: #721c24; background: #f8d7da; }
        .password-strength.strong { display: block; color: #155724; background: #d4edda; }
        .password-requirements { font-size: 12px; color: #666; margin-top: 5px; padding: 10px; background: #f8f9fa; border-radius: 5px; border-left: 3px solid #667eea; }
        .requirement { display: flex; align-items: center; margin: 3px 0; }
        .requirement.met { color: #28a745; }
        .requirement.unmet { color: #dc3545; }
        .requirement-icon { margin-right: 8px; font-weight: bold; }
        .btn-primary { width: 100%; padding: 15px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin-top: 10px; }
        .btn-primary:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3); }
        .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-secondary { width: 100%; padding: 12px; background: #6c757d; color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin-top: 10px; }
        .btn-secondary:hover { background: #5a6268; transform: translateY(-2px); }
        .verification-sent-message { display: none; text-align: center; padding: 30px; background: #e7f3ff; border-radius: 15px; border: 1px solid #b3d9ff; }
        .verification-sent-message h3 { color: #004085; margin-bottom: 15px; }
        .verification-sent-message p { color: #004085; margin-bottom: 10px; }
        .verification-sent-message .icon { font-size: 3rem; margin-bottom: 15px; }
        .message { position: fixed; top: 20px; right: 20px; padding: 15px 25px; border-radius: 10px; color: white; font-weight: 500; z-index: 10000; box-shadow: 0 5px 15px rgba(0,0,0,0.2); animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .message.success { background: linear-gradient(135deg, #28a745, #20c997); }
        .message.error { background: linear-gradient(135deg, #dc3545, #e83e8c); }
        .back-link { text-align: center; margin-top: 20px; }
        .back-link a { color: #667eea; text-decoration: none; font-weight: 500; }
        .back-link a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>WizDesk</h1>
            <p>Register as Team Leader</p>
        </header>

        <div class="form-container">
            <div class="form-card">
                
                <div id="verificationSentMessage" class="verification-sent-message">
                    <div class="icon">üìß</div>
                    <h3>Check Your Inbox!</h3>
                    <p>We've sent a verification link to <strong id="sentToEmail">your email</strong>.</p>
                    <p>Click the link in the email to create your team and complete your registration.</p>
                    <p style="margin-top: 20px; font-size: 0.9rem; color: #6c757d;">You can now close this page.</p>
                </div>

                <div id="registrationContainer">
                    <h2>Create Your Team</h2>
                    <form id="leaderRegisterForm">
                        <div class="form-group">
                            <input type="text" id="leaderName" placeholder="Your Full Name" required>
                        </div>
                        <div class="form-group">
                            <input type="email" id="leaderEmail" placeholder="Email Address" required>
                        </div>
                        <div class="form-group">
                            <input type="password" id="leaderPassword" placeholder="Password" required minlength="6">
                            <div id="passwordStrength" class="password-strength"></div>
                            <div class="password-requirements">
                                <div class="requirement unmet" id="reqLength"><span class="requirement-icon">‚óã</span> At least 6 characters</div>
                                <div class="requirement unmet" id="reqSpecial"><span class="requirement-icon">‚óã</span> At least 1 special character</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <input type="password" id="confirmPassword" placeholder="Confirm Password" required>
                            <div id="passwordMatch" class="password-match"></div>
                        </div>
                        <div class="form-group">
                            <input type="text" id="teamName" placeholder="Your New Team's Name" required>
                        </div>
                        
                        <button type="submit" class="btn-primary" id="verifyEmailBtn">
                            Send Verification Email
                        </button>
                    </form>
                    <div style="margin-top: 20px;">
                        <button onclick="window.location.href='index.html'" class="btn-secondary">Back to Login</button>
                    </div>
                    <p class="back-link">
                        <a href="index.html">‚Üê Already have an account?</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '/api';

        // --- DOM Elements ---
        const leaderRegisterForm = document.getElementById('leaderRegisterForm');
        const registrationContainer = document.getElementById('registrationContainer');
        const verificationSentMessage = document.getElementById('verificationSentMessage');
        const sentToEmail = document.getElementById('sentToEmail');
        const verifyEmailBtn = document.getElementById('verifyEmailBtn');
        const passwordInput = document.getElementById('leaderPassword');
        const confirmPasswordInput = document.getElementById('confirmPassword');
        const passwordMatchDiv = document.getElementById('passwordMatch');
        const passwordStrengthDiv = document.getElementById('passwordStrength');
        const reqLength = document.getElementById('reqLength');
        const reqSpecial = document.getElementById('reqSpecial');

        // --- Utility Functions ---
        const showMessage = (message, type = 'success') => {
            document.querySelectorAll('.message').forEach(el => el.remove());
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = message;
            document.body.appendChild(messageDiv);
            setTimeout(() => messageDiv.remove(), 5000);
        };

        const setButtonLoading = (button, isLoading) => {
            button.disabled = isLoading;
            button.textContent = isLoading ? 'Sending...' : 'Send Verification Email';
        };

        // --- Password Validation Logic ---
        function checkPasswordStrength(password) {
            const requirements = {
                length: password.length >= 6,
                special: /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)
            };
            updateRequirementIndicators(requirements);

            if (requirements.length && requirements.special) {
                passwordStrengthDiv.textContent = 'Strong password';
                passwordStrengthDiv.className = 'password-strength strong';
                passwordInput.classList.remove('error');
                passwordInput.classList.add('success');
                return true;
            } else {
                passwordStrengthDiv.textContent = 'Weak password';
                passwordStrengthDiv.className = 'password-strength weak';
                passwordInput.classList.add('error');
                passwordInput.classList.remove('success');
                return false;
            }
        }

        function updateRequirementIndicators(requirements) {
            updateIndicator(reqLength, requirements.length, 'At least 6 characters');
            updateIndicator(reqSpecial, requirements.special, 'At least 1 special character');
        }

        function updateIndicator(element, isMet, text) {
            element.className = `requirement ${isMet ? 'met' : 'unmet'}`;
            element.innerHTML = `<span class="requirement-icon">${isMet ? '‚úì' : '‚óã'}</span> ${text}`;
        }

        function checkPasswordMatch() {
            const isMatch = passwordInput.value === confirmPasswordInput.value && confirmPasswordInput.value !== '';
            if (confirmPasswordInput.value === '') {
                passwordMatchDiv.style.display = 'none';
                confirmPasswordInput.classList.remove('error', 'success');
            } else if (isMatch) {
                passwordMatchDiv.textContent = '‚úì Passwords match';
                passwordMatchDiv.className = 'password-match success';
                confirmPasswordInput.classList.remove('error');
                confirmPasswordInput.classList.add('success');
            } else {
                passwordMatchDiv.textContent = '‚úó Passwords do not match';
                passwordMatchDiv.className = 'password-match error';
                confirmPasswordInput.classList.add('error');
                confirmPasswordInput.classList.remove('success');
            }
            return isMatch;
        }

        // --- Form Submission Logic ---
        function validateForm() {
            const isPasswordStrong = checkPasswordStrength(passwordInput.value);
            const passwordsMatch = checkPasswordMatch();
            verifyEmailBtn.disabled = !(isPasswordStrong && passwordsMatch);
        }

        async function handleRegistrationSubmit(event) {
            event.preventDefault();
            validateForm(); // Final check before submit
            if (verifyEmailBtn.disabled) {
                showMessage('Please fix the errors before submitting.', 'error');
                return;
            }

            setButtonLoading(verifyEmailBtn, true);

            const name = document.getElementById('leaderName').value;
            const email = document.getElementById('leaderEmail').value;
            const password = passwordInput.value;
            const teamName = document.getElementById('teamName').value;

            try {
                const response = await fetch(`${API_BASE}/auth/send-verification`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password, teamName })
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.error || 'An unknown error occurred.');
                }
                
                // Success: Show the "check your email" message
                showMessage('Verification email sent! Check your inbox to continue.', 'success');
                sentToEmail.textContent = email;
                registrationContainer.style.display = 'none';
                verificationSentMessage.style.display = 'block';

            } catch (error) {
                showMessage(error.message, 'error');
                setButtonLoading(verifyEmailBtn, false); // Re-enable button on failure
            }
        }
        
        // --- Event Listeners ---
        leaderRegisterForm.addEventListener('submit', handleRegistrationSubmit);
        passwordInput.addEventListener('input', validateForm);
        confirmPasswordInput.addEventListener('input', validateForm);
        
        // Add listeners to other fields to enable the button as the user types
        ['leaderName', 'leaderEmail', 'teamName'].forEach(id => {
            document.getElementById(id).addEventListener('input', validateForm);
        });

        // Initial validation check on page load
        validateForm();
    </script>
</body>
</html>
